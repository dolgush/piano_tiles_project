//---------------------------------------------------------------------------

#include <vcl.h>
#pragma hdrstop

#include "Unit3.h"
#include "Unit1.h"
#include "Unit2.h"
#include "cmath"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
TForm1 *Form1;
Graphics::TBitmap  *kadr = new Graphics::TBitmap(),
					*kadr2 = new Graphics::TBitmap(),
				   *fon = new Graphics::TBitmap(),
				   *fon_kadr1 = new Graphics::TBitmap(),
				   *fon_kadr2 = new Graphics::TBitmap();
double w, h, x_line=150, y_line1 = -625,y_line2 = -200,y_line3 = -1050;
double v0;
bool kost = true;
double u;
double i = 0;
extern int theme;
double t=0;
double k=0;
bool line1 = false;
bool line2 = false;
bool line3 = false;
TRect pr_kadr, pr_fon1, pr_kadr2,pr_fon2;
//---------------------------------------------------------------------------
__fastcall TForm1::TForm1(TComponent* Owner)
	: TForm(Owner)
{
}
//---------------------------------------------------------------------------
void __fastcall TForm1::Timer1Timer(TObject *Sender)
{
	Image1 -> Canvas -> Draw (x_line, y_line2, fon_kadr2);
	Image1 -> Canvas -> Draw (x_line, y_line1, fon_kadr1);
	x_line = 150;
	y_line2 += 20;
	y_line1 += 20;

	if (y_line2 > Image1 -> Height)
	{
		y_line2 = -200;
		t=0;
		line2 = false;
	}
	if (y_line1 > Image1 -> Height)
	{
		y_line1 = -200;
		t=0;
		line1 = false;
	}
	if (line2 == true)
	{
		pr_fon2 = Bounds(x_line, y_line2, w, h);
		fon_kadr2 -> Canvas -> CopyRect(pr_kadr2, fon -> Canvas, pr_fon2);
		Image1 -> Canvas -> Draw(x_line, y_line2, kadr2);
	}
	else
	{
	 pr_fon2 = Bounds(x_line, y_line2, w, h);
	 fon_kadr2 -> Canvas -> CopyRect(pr_kadr, fon -> Canvas, pr_fon2);
	 Image1 -> Canvas -> Draw(x_line, y_line2, kadr);
	}
	if (line1 == true)
	{
		pr_fon1 = Bounds(x_line, y_line1, w, h);
		fon_kadr1 -> Canvas -> CopyRect(pr_kadr2, fon -> Canvas, pr_fon1);
		Image1 -> Canvas -> Draw(x_line, y_line1, kadr2);
	}
	else
	{
	 pr_fon1 = Bounds(x_line, y_line1, w, h);
	 fon_kadr1 -> Canvas -> CopyRect(pr_kadr, fon -> Canvas, pr_fon1);
	 Image1 -> Canvas -> Draw(x_line, y_line1, kadr);
	}
}
//---------------------------------------------------------------------------


void __fastcall TForm1::FormKeyDown(TObject *Sender, WORD &Key, TShiftState Shift)

{
	if(y_line2 >=500 && y_line2 <= 900 && Key == 87)
		line2 = true;
	if(y_line1 >=500 && y_line1 <= 900 && Key == 87)
		line1 = true;
}
//---------------------------------------------------------------------------

void __fastcall TForm1::Button1Click(TObject *Sender)
{
	Timer1->Enabled = true;
    if (theme == 1)
	{
		fon -> LoadFromFile("pole1.bmp");
	}
	if (theme == 2)
	{
		fon -> LoadFromFile("pole2.bmp");
	}
    Image1 -> Picture -> Assign(fon);
   kadr -> LoadFromFile("kletka.bmp");
   kadr2 -> LoadFromFile("kletka2.bmp");
   w = kadr -> Width;
   h = kadr -> Height;
   fon_kadr1 -> Width = w;
   fon_kadr1 -> Height = h;
   fon_kadr2 -> Width = w;
   fon_kadr2 -> Height = h;
   pr_kadr = Bounds(0, 0, w, h);
   pr_kadr2 = Bounds(0, 0, w, h);
   x_line = -w;
   pr_fon1 = Bounds(x_line, y_line1, w, h);
   pr_fon2 = Bounds(x_line, y_line2, w, h);
   fon_kadr1 -> Canvas -> CopyRect(pr_kadr, fon -> Canvas, pr_fon1);
   fon_kadr1 -> Canvas -> CopyRect(pr_kadr, fon -> Canvas, pr_fon2);
}
//---------------------------------------------------------------------------

